<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÈÄöÂæÄË≤°ÂØåËá™Áî±‰πãË∑Ø</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Icons (Lucide) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Tailwind Config for Cute Colors -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        ios: {
                            bg: '#F2F2F7',
                            card: 'rgba(255, 255, 255, 0.8)',
                            blue: '#007AFF',
                            green: '#34C759',
                            red: '#FF3B30',
                            yellow: '#FFCC00',
                            indigo: '#5856D6',
                            purple: '#AF52DE',
                            teal: '#5AC8FA',
                            pink: '#FF2D55',
                        }
                    },
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', "Segoe UI", 'Roboto', "Helvetica Neue", 'Arial', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #F2F2F7;
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        /* Custom Scrollbar for hidden look */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* iOS Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Animations */
        @keyframes popIn {
            0% { transform: scale(0.95); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pop {
            animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-up {
            animation: slideUp 0.3s ease-out forwards;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- Configuration & Constants ---
        const DEFAULT_REPO = "zenningh1983/money";
        const FILE_PATH = "money_data.json";
        
        // ‚òÖ‚òÖ‚òÖ È†êË®≠ Token Ë®≠ÂÆöÂçÄ ‚òÖ‚òÖ‚òÖ
        // Ë´ãÂú®Ê≠§Â°´ÂÖ• ghp_ ÂæåÈù¢ÁöÑ‰∫ÇÁ¢º„ÄÇ
        // „ÄêÈáçË¶ÅÊäÄÂ∑ß„ÄëÔºöÁÇ∫‰∫ÜÈÅøÂÖç GitHub Ëá™ÂãïÂÅµÊ∏¨Âà∞ Token ËÄåÂ∞éËá¥ Deploy Â§±ÊïóÊàñ Token Â§±ÊïàÔºå
        // Ë´ãÂãôÂøÖÂ∞á Token ÊãÜÊàêÂÖ©ÊÆµÊàñÂ§öÊÆµÂ≠ó‰∏≤Áõ∏Âä†„ÄÇ
        // ÁØÑ‰æãÔºöÂ¶ÇÊûúÊÇ®ÁöÑÂæåÁ¢ºÊòØ "Abcde12345"ÔºåË´ãÂØ´ÊàêÔºö "Abcde" + "12345"
        const DEFAULT_TOKEN_SUFFIX = "" + ""; 
        
        // Initial Data Structure
        const INITIAL_DATA = {
            users: [{ id: 'default', name: 'È†êË®≠Â∏≥Êú¨' }],
            currentUser: 'default',
            accounts: [
                { id: 'acc1', name: 'ÊàëÁöÑÈå¢ÂåÖ', type: 'cash', balance: 0, color: 'bg-orange-400' },
                { id: 'acc2', name: 'Ëñ™Ë≥áÂ∏≥Êà∂', type: 'bank', balance: 0, color: 'bg-blue-500' },
                { id: 'acc3', name: '‰ø°Áî®Âç°', type: 'credit', balance: 0, color: 'bg-purple-500' }
            ],
            categories: [
                // 15 Expenses
                { id: 'exp1', name: 'Êó©ÂçàÈ§ê', type: 'expense', icon: 'üçî' },
                { id: 'exp2', name: 'ÊôöÈ§ê', type: 'expense', icon: 'üç±' },
                { id: 'exp3', name: 'È£≤Êñô', type: 'expense', icon: 'üßã' },
                { id: 'exp4', name: '‰∫§ÈÄö', type: 'expense', icon: 'üöå' },
                { id: 'exp5', name: 'Êó•Áî®ÂìÅ', type: 'expense', icon: 'üßª' },
                { id: 'exp6', name: 'ÊàøÁßü', type: 'expense', icon: 'üè†' },
                { id: 'exp7', name: 'Ê∞¥ÈõªË≤ª', type: 'expense', icon: '‚ö°' },
                { id: 'exp8', name: 'ÈõªË©±Ë≤ª', type: 'expense', icon: 'üì±' },
                { id: 'exp9', name: 'Â®õÊ®Ç', type: 'expense', icon: 'üéÆ' },
                { id: 'exp10', name: 'ÈÜ´ÁôÇ', type: 'expense', icon: 'üíä' },
                { id: 'exp11', name: 'ÊúçÈ£æ', type: 'expense', icon: 'üëï' },
                { id: 'exp12', name: '‰øùÈö™', type: 'expense', icon: 'üõ°Ô∏è' },
                { id: 'exp13', name: 'ÊïôËÇ≤', type: 'expense', icon: 'üìö' },
                { id: 'exp14', name: 'Á§æ‰∫§', type: 'expense', icon: 'üéÅ' },
                { id: 'exp15', name: 'ÂÖ∂‰ªñ', type: 'expense', icon: 'üí∏' },
                // 5 Income
                { id: 'inc1', name: 'Ëñ™Ë≥á', type: 'income', icon: 'üí∞' },
                { id: 'inc2', name: 'ÁçéÈáë', type: 'income', icon: 'üíé' },
                { id: 'inc3', name: 'ÊäïË≥á', type: 'income', icon: 'üìà' },
                { id: 'inc4', name: 'ÂÖºËÅ∑', type: 'income', icon: 'üíº' },
                { id: 'inc5', name: 'ÂÖ∂‰ªñ', type: 'income', icon: 'üì•' },
            ],
            transactions: [], // { id, date, amount, type, categoryId, accountId, note }
            stocks: [], // { id, symbol, name, shares, avgCost, currentPrice }
            stockTransactions: [], // { id, symbol, type (buy/sell), price, shares, date }
        };

        const KEYWORD_MAPPING = {
            'È§ê': 'exp1', 'È£Ø': 'exp2', 'È£≤': 'exp3', 'Ëå∂': 'exp3', 'Âíñ': 'exp3',
            'Ëªä': 'exp4', 'Ê≤π': 'exp4', 'Êç∑ÈÅã': 'exp4',
            'Ë∂ÖÂïÜ': 'exp5', 'ÂÖ®ËÅØ': 'exp5', 'ÂÆ∂Ê®ÇÁ¶è': 'exp5',
            'Ëñ™': 'inc1', 'Âà©ÊÅØ': 'inc3'
        };

        // --- Components ---

        // Custom Toast
        const Toast = ({ message, type, onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 2000); 
                return () => clearTimeout(timer);
            }, [onClose]);

            const bgClass = type === 'error' ? 'bg-red-500/90' : 'bg-gray-800/90';

            return (
                <div className="fixed inset-0 flex items-center justify-center pointer-events-none z-[100]">
                    <div className={`px-6 py-3 rounded-2xl text-white text-sm font-medium shadow-2xl 
                                     backdrop-blur-md ${bgClass} animate-pop`}>
                        {message}
                    </div>
                </div>
            );
        };

        // Modal Layout
        const Modal = ({ children, onClose, title }) => (
            <div className="fixed inset-0 z-40 flex items-center justify-center p-4 bg-black/20 backdrop-blur-sm animate-pop">
                <div className="bg-white/90 w-full max-w-md rounded-3xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
                    <div className="p-4 border-b border-gray-100 flex justify-between items-center bg-white/50 backdrop-blur-xl sticky top-0">
                        <h3 className="font-bold text-lg text-gray-800">{title}</h3>
                        <button onClick={onClose} className="p-2 bg-gray-100 rounded-full hover:bg-gray-200">
                            <i data-lucide="x" className="w-5 h-5 text-gray-500"></i>
                        </button>
                    </div>
                    <div className="overflow-y-auto p-4 custom-scrollbar">
                        {children}
                    </div>
                </div>
            </div>
        );

        // --- Main Application ---

        const App = () => {
            // State
            const [view, setView] = useState('dashboard'); // dashboard, accounting, wealth, settings
            const [data, setData] = useState(INITIAL_DATA);
            // ‰øÆÊîπÔºöÂàùÂßãÂåñÊôÇËã• localStorage Ê≤íË≥áÊñôÔºåÂâáËÆÄÂèñ DEFAULT_TOKEN_SUFFIX
            const [githubToken, setGithubToken] = useState(localStorage.getItem('gh_token') || (DEFAULT_TOKEN_SUFFIX ? `ghp_${DEFAULT_TOKEN_SUFFIX}` : ''));
            const [repo, setRepo] = useState(DEFAULT_REPO); // Fixed repo
            const [syncStatus, setSyncStatus] = useState('idle'); // idle, syncing, success, error
            const [sha, setSha] = useState(null);
            const [toast, setToast] = useState(null);
            
            // Sub-views state
            const [selectedAccount, setSelectedAccount] = useState(null);
            const [currentDate, setCurrentDate] = useState(new Date());
            
            // Dashboard Asset Visibility
            const [showAssets, setShowAssets] = useState(false);

            // Generic Input Modal State
            const [inputModal, setInputModal] = useState({ show: false, title: '', value: '', type: '', data: null });

            // Helper to show toast
            const showToast = (msg, type = 'info') => setToast({ message: msg, type });

            // Initialize Lucide Icons
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                    // Fix: Add a small delay to ensure DOM is ready after view transitions
                    // This fixes the issue where icons (like the eye) disappear when navigating back
                    setTimeout(() => window.lucide.createIcons(), 50);
                }
            }, [view, toast, inputModal.show, showAssets, selectedAccount, syncStatus]);

            // --- GitHub Sync Logic ---

            const fetchData = async (silent = false) => {
                if (!githubToken) return;
                
                // Sanitize token to ensure ASCII only
                const safeToken = githubToken.replace(/[^\x00-\x7F]/g, "").trim();
                if (!safeToken) return;

                if (!silent) setSyncStatus('syncing');
                try {
                    const res = await fetch(`https://api.github.com/repos/${repo}/contents/${FILE_PATH}`, {
                        headers: { 
                            'Authorization': `token ${safeToken}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (res.status === 404) {
                        // File doesn't exist, will create on first save
                        setSyncStatus('success');
                        return;
                    }

                    if (res.status === 401) {
                        if (!silent) showToast('Token ÁÑ°ÊïàÊàñÈÅéÊúü (401)', 'error');
                        setSyncStatus('error');
                        return;
                    }

                    if (!res.ok) throw new Error(`Fetch failed: ${res.status}`);

                    const json = await res.json();
                    const content = decodeURIComponent(escape(window.atob(json.content)));
                    setData(JSON.parse(content));
                    setSha(json.sha);
                    setSyncStatus('success');
                } catch (e) {
                    console.error("Fetch Error:", e);
                    if(!silent) {
                        setSyncStatus('error');
                    }
                }
            };

            const saveData = async (newData = data, showSuccessToast = true, explicitSha = null) => {
                if (!githubToken) {
                    showToast('Ë´ãÂÖàË®≠ÂÆö GitHub Token', 'error');
                    return;
                }
                
                // Sanitize token
                const safeToken = githubToken.replace(/[^\x00-\x7F]/g, "").trim();
                
                setSyncStatus('syncing');
                try {
                    // Update state first
                    setData(newData);
                    
                    const content = window.btoa(unescape(encodeURIComponent(JSON.stringify(newData))));
                    const body = {
                        message: `Auto backup ${new Date().toLocaleString()}`,
                        content: content,
                        // Use explicitSha if provided (for saveAndTest), otherwise use state sha
                        sha: explicitSha !== null ? explicitSha : sha 
                    };

                    // Clean body if sha is null/undefined to allow creating new file
                    if (!body.sha) delete body.sha;

                    const res = await fetch(`https://api.github.com/repos/${repo}/contents/${FILE_PATH}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${safeToken}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(body)
                    });

                    if (res.status === 401) {
                        throw new Error("Token ÈåØË™§ÊàñÈÅéÊúü (401)");
                    }

                    if (!res.ok) {
                        const errBody = await res.json().catch(() => ({}));
                        throw new Error(`Save failed: ${res.status} ${errBody.message || ''}`);
                    }
                    
                    const json = await res.json();
                    setSha(json.content.sha); // Update SHA for next write
                    setSyncStatus('success');
                    if (showSuccessToast) showToast('Â∑≤ÂÇô‰ªΩÂà∞ GitHub');
                } catch (e) {
                    console.error("Save Error:", e);
                    setSyncStatus('error');
                    const errorMsg = e.message.includes('401') ? 'Token ÁÑ°ÊïàÊàñÈÅéÊúü (401)' : 'ÂÇô‰ªΩÂ§±ÊïóÔºåË´ãÊ™¢Êü•Ê¨äÈôê';
                    showToast(errorMsg, 'error');
                }
            };

            // Initial Fetch
            useEffect(() => {
                if (githubToken) fetchData();
            }, []);

            // Handle View Change (Auto refresh data)
            useEffect(() => {
                if (githubToken && view !== 'settings') fetchData(true); // Silent fetch on view switch (except settings)
            }, [view]);


            // --- Logic: Accounting ---

            const getFilteredTransactions = () => {
                const y = currentDate.getFullYear();
                const m = currentDate.getMonth();
                return data.transactions.filter(t => {
                    const d = new Date(t.date);
                    return d.getFullYear() === y && d.getMonth() === m && t.accountId === selectedAccount;
                }).sort((a, b) => new Date(b.date) - new Date(a.date));
            };

            const calculateBalance = (accId) => {
                const initial = data.accounts.find(a => a.id === accId)?.balance || 0;
                const txs = data.transactions.filter(t => t.accountId === accId);
                const total = txs.reduce((acc, curr) => {
                    return curr.type === 'income' ? acc + curr.amount : acc - curr.amount;
                }, 0);
                return initial + total;
            };

            const autoTag = (note) => {
                for (let key in KEYWORD_MAPPING) {
                    if (note.includes(key)) return KEYWORD_MAPPING[key];
                }
                return 'exp15'; // Default Other
            };

            // --- Handlers for Custom Input Modal ---
            const handleInputConfirm = () => {
                const val = inputModal.value.trim();
                if (!val) {
                    showToast('Ë´ãËº∏ÂÖ•ÂêçÁ®±', 'error');
                    return;
                }

                if (inputModal.type === 'add_ledger') {
                    const newUser = { id: Date.now().toString(), name: val };
                    const newData = { ...data, users: [...data.users, newUser], currentUser: newUser.id };
                    saveData(newData);
                    showToast(`Â∑≤Âª∫Á´ãÂ∏≥Êú¨Ôºö${val}`);
                } 
                else if (inputModal.type === 'rename_ledger') {
                    const userId = inputModal.data;
                    const newUsers = data.users.map(u => u.id === userId ? { ...u, name: val } : u);
                    const newData = { ...data, users: newUsers };
                    saveData(newData);
                    showToast('Â∑≤‰øÆÊîπÂ∏≥Êú¨ÂêçÁ®±');
                }
                else if (inputModal.type === 'add_account') {
                    const newAcc = { 
                        id: Date.now().toString(), 
                        name: val, type: 'cash', balance: 0, 
                        color: 'bg-gray-400' 
                    };
                    saveData({...data, accounts: [...data.accounts, newAcc]});
                    showToast(`Â∑≤Êñ∞Â¢ûÂ∏≥Êà∂Ôºö${val}`);
                }

                setInputModal({ show: false, title: '', value: '', type: '', data: null });
            };

            // --- Views ---

            // 1. Settings View
            const SettingsView = () => {
                const [showToken, setShowToken] = useState(false);

                // Token display helper
                const getTokenDisplay = () => {
                    if (githubToken.startsWith('ghp_')) return githubToken.replace(/^ghp_/, '');
                    return githubToken;
                };

                const handleTokenChange = (e) => {
                    // Remove non-ASCII characters immediately to prevent header errors
                    const val = e.target.value.replace(/[^\x00-\x7F]/g, "").trim();
                    
                    if (!val) {
                        setGithubToken('');
                        localStorage.removeItem('gh_token');
                        return;
                    }
                    
                    let newToken = val;
                    if (val.startsWith('ghp_') || val.startsWith('github_pat_')) {
                        newToken = val;
                    } else {
                        newToken = `ghp_${val}`;
                    }

                    setGithubToken(newToken);
                    localStorage.setItem('gh_token', newToken);
                };

                const handleClearToken = () => {
                    setGithubToken('');
                    localStorage.removeItem('gh_token');
                    setSha(null);
                };

                const handleSaveAndTest = async () => {
                    if (!githubToken) {
                        showToast('Ë´ãÂÖàËº∏ÂÖ• Token', 'error');
                        return;
                    }
                    
                    const safeToken = githubToken.replace(/[^\x00-\x7F]/g, "").trim();
                    showToast('ÈÄ£Á∑öÊ∏¨Ë©¶‰∏≠...');
                    
                    try {
                        const res = await fetch(`https://api.github.com/repos/${repo}/contents/${FILE_PATH}`, {
                            headers: { 
                                'Authorization': `token ${safeToken}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        });

                        if (res.status === 401) {
                             throw new Error("Token ÈåØË™§ÊàñÈÅéÊúü (401)");
                        }

                        if (res.ok) {
                            const json = await res.json();
                            setSha(json.sha); 
                            await saveData(data, true, json.sha); 
                        } else if (res.status === 404) {
                            setSha(null);
                            await saveData(data, true, null);
                        } else {
                            throw new Error(`Connection check failed: ${res.status}`);
                        }
                    } catch (e) {
                        console.error("Handshake failed:", e);
                        const errorMsg = e.message.includes('401') ? 'Token ÁÑ°ÊïàÊàñÈÅéÊúü (401)' : 'ÈÄ£Á∑öÂ§±ÊïóÔºåË´ãÊ™¢Êü•Ê¨äÈôê';
                        showToast(errorMsg, 'error');
                    }
                };

                return (
                    <div className="p-6 space-y-6">
                        <div className="bg-white rounded-2xl p-4 shadow-sm space-y-4">
                            <div>
                                <label className="block text-sm text-gray-500 mb-1">GitHub Personal Access Token</label>
                                <div className="relative">
                                    <span className="absolute left-3 top-3 text-gray-400 select-none">ghp_</span>
                                    <input 
                                        type={showToken ? "text" : "password"}
                                        className="w-full p-3 pl-12 pr-20 bg-gray-50 rounded-xl border-none focus:ring-2 focus:ring-blue-500 font-mono"
                                        value={getTokenDisplay()}
                                        onChange={handleTokenChange}
                                        placeholder="Ëº∏ÂÖ• ghp_ ÂæåÁöÑ token ‰∫ÇÁ¢º"
                                    />
                                    <div className="absolute right-2 top-2 flex gap-1">
                                        <button 
                                            onClick={() => setShowToken(!showToken)}
                                            className="p-1.5 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-200 transition"
                                        >
                                            {showToken ? <i data-lucide="eye-off" className="w-4 h-4"></i> : <i data-lucide="eye" className="w-4 h-4"></i>}
                                        </button>
                                        <button 
                                            onClick={handleClearToken}
                                            className="p-1.5 text-gray-400 hover:text-red-500 rounded-lg hover:bg-red-50 transition"
                                        >
                                            <i data-lucide="trash-2" className="w-4 h-4"></i>
                                        </button>
                                    </div>
                                </div>
                                <p className="text-xs text-gray-400 mt-2">
                                    Repository: <span className="font-mono">{DEFAULT_REPO}</span>
                                </p>
                            </div>
                            
                            <button 
                                onClick={handleSaveAndTest}
                                className="w-full py-3 bg-ios-blue text-white font-bold rounded-xl shadow-lg active:scale-95 transition"
                            >
                                ÂÑ≤Â≠ò‰∏¶Ê∏¨Ë©¶ÈÄ£Á∑ö
                            </button>
                        </div>

                        <div className="bg-white rounded-2xl p-4 shadow-sm">
                            <h3 className="font-bold mb-3">Â∏≥Êú¨ÁÆ°ÁêÜ</h3>
                            {data.users.map(u => (
                                <div key={u.id} className="flex justify-between items-center py-3 border-b border-gray-100 last:border-0">
                                    <div className="flex items-center gap-2">
                                        <span className="font-medium text-gray-700">{u.name}</span>
                                        <button 
                                            onClick={() => setInputModal({
                                                show: true,
                                                title: '‰øÆÊîπÂ∏≥Êú¨ÂêçÁ®±',
                                                value: u.name,
                                                type: 'rename_ledger',
                                                data: u.id
                                            })}
                                            className="text-gray-400 p-1 hover:text-ios-blue"
                                        >
                                            <i data-lucide="pencil" className="w-3 h-3"></i>
                                        </button>
                                    </div>
                                    <span className="text-xs text-gray-400">{u.id === data.currentUser ? '(ÁõÆÂâç‰ΩøÁî®)' : ''}</span>
                                </div>
                            ))}
                            <button 
                                className="mt-3 w-full py-3 text-ios-blue bg-blue-50 rounded-xl font-bold active:scale-95 transition"
                                onClick={() => setInputModal({ 
                                    show: true, 
                                    title: 'Êñ∞Â¢ûÂ∏≥Êú¨', 
                                    value: '', 
                                    type: 'add_ledger' 
                                })}
                            >
                                + Êñ∞Â¢ûÂ∏≥Êú¨
                            </button>
                        </div>
                        
                        <div className="text-center text-xs text-gray-400 mt-8">
                            Version 1.7 ‚Ä¢ Zenning Money
                        </div>
                    </div>
                );
            };

            // 2. Dashboard View (New Home)
            const DashboardView = () => {
                const totalAssets = data.accounts.reduce((sum, acc) => sum + calculateBalance(acc.id), 0) 
                                  + data.stocks.reduce((sum, s) => sum + (s.quantity * s.currentPrice), 0);
                
                const currentUser = data.users.find(u => u.id === data.currentUser);

                return (
                    <div className="p-6 space-y-6 pb-20">
                        
                        {/* Ledger Switcher - Updated UI */}
                        <div className="flex justify-center">
                            <div className="bg-white/50 backdrop-blur-sm rounded-full py-2 px-5 flex items-center gap-2 shadow-sm border border-white/40">
                                <span className="text-gray-600 text-sm font-medium">ÁõÆÂâçÂ∏≥Êú¨Ôºö</span>
                                <select 
                                    className="bg-transparent text-sm text-ios-blue font-bold outline-none cursor-pointer pr-1"
                                    value={data.currentUser}
                                    onChange={(e) => {
                                        const newData = {...data, currentUser: e.target.value};
                                        setData(newData);
                                        saveData(newData);
                                        showToast('ÂàáÊèõÊàêÂäü');
                                    }}
                                >
                                    {data.users.map(u => (
                                        <option key={u.id} value={u.id}>{u.name}</option>
                                    ))}
                                </select>
                            </div>
                        </div>

                        {/* Total Assets Card */}
                        <div className="bg-gradient-to-br from-indigo-500 to-purple-600 rounded-3xl p-8 text-white shadow-xl shadow-indigo-200 relative overflow-hidden">
                            <div className="absolute top-0 right-0 p-4 opacity-50">
                                <i data-lucide="wallet" className="w-24 h-24 -mt-8 -mr-8 transform rotate-12"></i>
                            </div>
                            <div className="relative z-10">
                                <div className="text-indigo-100 text-sm font-medium mb-2 flex items-center gap-2">
                                    Á∏ΩË≥áÁî¢
                                    <button 
                                        onClick={() => setShowAssets(!showAssets)} 
                                        className="hover:text-white transition p-1 rounded-full active:bg-white/10"
                                    >
                                        {showAssets ? 
                                            <i key="eye-open" data-lucide="eye" className="w-4 h-4"></i> : 
                                            <i key="eye-closed" data-lucide="eye-off" className="w-4 h-4"></i>
                                        }
                                    </button>
                                </div>
                                <div className="text-4xl font-bold tracking-tight">
                                    {showAssets ? `$${totalAssets.toLocaleString()}` : '****'}
                                </div>
                            </div>
                        </div>

                        {/* Main Modules */}
                        <div className="grid grid-cols-2 gap-4 mt-8">
                            <button 
                                onClick={() => { setSelectedAccount(null); setView('accounting'); }}
                                className="bg-white p-6 rounded-3xl shadow-sm hover:shadow-md transition active:scale-95 flex flex-col items-center justify-center gap-3 aspect-square"
                            >
                                <div className="w-14 h-14 bg-blue-100 rounded-full flex items-center justify-center text-ios-blue">
                                    <i data-lucide="notebook-pen" className="w-7 h-7"></i>
                                </div>
                                <span className="font-bold text-gray-800 text-lg">Ë®òÂ∏≥</span>
                                <span className="text-xs text-gray-400">Á¥ÄÈåÑÊî∂ÊîØËàáÂ∏≥Êà∂</span>
                            </button>

                            <button 
                                onClick={() => setView('wealth')}
                                className="bg-white p-6 rounded-3xl shadow-sm hover:shadow-md transition active:scale-95 flex flex-col items-center justify-center gap-3 aspect-square"
                            >
                                <div className="w-14 h-14 bg-purple-100 rounded-full flex items-center justify-center text-ios-purple">
                                    <i data-lucide="trending-up" className="w-7 h-7"></i>
                                </div>
                                <span className="font-bold text-gray-800 text-lg">ÁêÜË≤°</span>
                                <span className="text-xs text-gray-400">ËÇ°Á•®ËàáÂ∫´Â≠òÁÆ°ÁêÜ</span>
                            </button>
                        </div>
                    </div>
                );
            };

            // 3. Accounting Module (Handles both Account List and Transaction List)
            const AccountingView = () => {
                const [showImport, setShowImport] = useState(false);
                const [importText, setImportText] = useState('');
                const [previewData, setPreviewData] = useState([]);
                const [showAdd, setShowAdd] = useState(false);
                const [newTx, setNewTx] = useState({ amount: '', note: '', type: 'expense', categoryId: 'exp1', date: new Date().toISOString().split('T')[0] });

                // Sub-View: Transaction List (for specific account)
                if (selectedAccount) {
                    const handleSmartImport = () => {
                        const lines = importText.split('\n');
                        const parsed = [];
                        lines.forEach((line, idx) => {
                            if (!line.trim()) return;
                            const dateMatch = line.match(/(\d{4}[-/]\d{1,2}[-/]\d{1,2})|(\d{1,2}[-/]\d{1,2})/);
                            const amountMatch = line.match(/(\d+(?:,\d+)*(?:\.\d+)?)/);
                            
                            if (amountMatch) {
                                let dateStr = new Date().toISOString().split('T')[0];
                                if (dateMatch) {
                                    const d = dateMatch[0].replace(/-/g, '/');
                                    dateStr = d.length < 6 ? `${new Date().getFullYear()}/${d}` : d;
                                    dateStr = new Date(dateStr).toISOString().split('T')[0];
                                }
                                
                                const amount = parseFloat(amountMatch[0].replace(/,/g, ''));
                                let note = line.replace(dateMatch?.[0] || '', '').replace(amountMatch[0], '').trim();
                                
                                parsed.push({
                                    id: Date.now() + idx,
                                    date: dateStr,
                                    amount: amount,
                                    note: note,
                                    type: 'expense',
                                    categoryId: autoTag(note),
                                    accountId: selectedAccount
                                });
                            }
                        });
                        setPreviewData(parsed);
                    };

                    const commitImport = () => {
                        saveData({
                            ...data,
                            transactions: [...data.transactions, ...previewData]
                        });
                        setPreviewData([]);
                        setImportText('');
                        setShowImport(false);
                    };

                    const saveTransaction = () => {
                        if(!newTx.amount) return;
                        const tx = {
                            ...newTx,
                            id: Date.now().toString(),
                            amount: parseFloat(newTx.amount),
                            accountId: selectedAccount
                        };
                        saveData({
                            ...data,
                            transactions: [...data.transactions, tx]
                        });
                        setShowAdd(false);
                        setNewTx({ amount: '', note: '', type: 'expense', categoryId: 'exp1', date: new Date().toISOString().split('T')[0] });
                    };

                    const filteredTxs = getFilteredTransactions();
                    const currentAccount = data.accounts.find(a => a.id === selectedAccount);

                    return (
                        <div className="pb-24">
                            {/* Account Detail Header */}
                            <div className="bg-white/80 backdrop-blur-md sticky top-0 z-10 px-6 py-4 border-b border-gray-200">
                                <div className="flex justify-between items-center mb-2">
                                    <button onClick={() => setSelectedAccount(null)} className="text-gray-500 flex items-center gap-1">
                                        <i data-lucide="chevron-left" className="w-5 h-5"></i> Â∏≥Êà∂ÂàóË°®
                                    </button>
                                    <div className="font-bold">{currentAccount?.name}</div>
                                    <button onClick={() => setShowImport(true)} className="text-ios-blue text-sm">Êô∫ÊÖßÂåØÂÖ•</button>
                                </div>
                                
                                <div className="flex items-center justify-between bg-gray-100 rounded-xl p-1">
                                    <button onClick={() => setCurrentDate(new Date(currentDate.setMonth(currentDate.getMonth()-1)))} className="p-2"><i data-lucide="chevron-left" className="w-4 h-4"></i></button>
                                    <span className="font-bold text-gray-700">
                                        {currentDate.getFullYear()}Âπ¥ {currentDate.getMonth() + 1}Êúà
                                    </span>
                                    <button onClick={() => setCurrentDate(new Date(currentDate.setMonth(currentDate.getMonth()+1)))} className="p-2"><i data-lucide="chevron-right" className="w-4 h-4"></i></button>
                                </div>
                            </div>

                            {/* Tx List */}
                            <div className="p-4 space-y-3">
                                {filteredTxs.length === 0 ? (
                                    <div className="text-center text-gray-400 mt-10">Êú¨ÊúàÂ∞öÁÑ°Á¥ÄÈåÑ</div>
                                ) : filteredTxs.map(tx => {
                                    const cat = data.categories.find(c => c.id === tx.categoryId);
                                    return (
                                        <div key={tx.id} className="bg-white p-4 rounded-2xl shadow-sm flex items-center justify-between">
                                            <div className="flex items-center gap-3">
                                                <div className="w-10 h-10 bg-gray-50 rounded-full flex items-center justify-center text-xl">
                                                    {cat?.icon || 'üìÑ'}
                                                </div>
                                                <div>
                                                    <div className="font-bold text-gray-800">{cat?.name || 'Êú™Áü•'}</div>
                                                    <div className="text-xs text-gray-400">{tx.date} {tx.note}</div>
                                                </div>
                                            </div>
                                            <div className={`font-bold ${tx.type === 'income' ? 'text-ios-green' : 'text-gray-800'}`}>
                                                {tx.type === 'income' ? '+' : '-'}${tx.amount.toLocaleString()}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>

                            {/* FAB */}
                            <button 
                                onClick={() => setShowAdd(true)}
                                className="fixed bottom-24 right-6 w-14 h-14 bg-ios-blue text-white rounded-full shadow-lg shadow-blue-300 flex items-center justify-center active:scale-90 transition z-20"
                            >
                                <i data-lucide="plus" className="w-8 h-8"></i>
                            </button>

                            {/* Modals */}
                            {showImport && (
                                <Modal title="Êô∫ÊÖßÂåØÂÖ•" onClose={() => setShowImport(false)}>
                                    {previewData.length === 0 ? (
                                        <div className="space-y-4">
                                            <p className="text-sm text-gray-500">Ë≤º‰∏ä‰æÜËá™Á∂≤ÈäÄ„ÄÅExcel ÊàñÁ∞°Ë®äÁöÑÈõú‰∫ÇÊñáÂ≠óÔºö</p>
                                            <textarea 
                                                className="w-full h-40 p-3 bg-gray-50 rounded-xl text-sm"
                                                placeholder="2023/10/01 ÂçàÈ§ê 150&#10;2023/10/02 Ëñ™Ê∞¥ 50000"
                                                value={importText}
                                                onChange={e => setImportText(e.target.value)}
                                            ></textarea>
                                            <button onClick={handleSmartImport} className="w-full py-3 bg-ios-blue text-white rounded-xl font-bold">Ëß£Êûê</button>
                                        </div>
                                    ) : (
                                        <div className="space-y-4">
                                            <div className="max-h-60 overflow-y-auto space-y-2">
                                                {previewData.map((item, idx) => (
                                                    <div key={idx} className="flex items-center justify-between text-sm bg-gray-50 p-2 rounded-lg">
                                                        <div>
                                                            <span className="text-gray-500 mr-2">{item.date}</span>
                                                            <span>{item.note}</span>
                                                        </div>
                                                        <div className="flex items-center gap-2">
                                                            <span className="font-bold">${item.amount}</span>
                                                            <button onClick={() => setPreviewData(previewData.filter((_, i) => i !== idx))} className="text-red-500"><i data-lucide="trash-2" className="w-4 h-4"></i></button>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                            <div className="flex gap-2">
                                                <button onClick={() => setPreviewData([])} className="flex-1 py-3 bg-gray-200 rounded-xl font-bold text-gray-600">Èáç‰æÜ</button>
                                                <button onClick={commitImport} className="flex-1 py-3 bg-ios-green text-white rounded-xl font-bold">Á¢∫Ë™çÂåØÂÖ• ({previewData.length})</button>
                                            </div>
                                        </div>
                                    )}
                                </Modal>
                            )}

                            {showAdd && (
                                <Modal title="Ë®ò‰∏ÄÁ≠Ü" onClose={() => setShowAdd(false)}>
                                    <div className="space-y-4">
                                        <div className="flex bg-gray-100 rounded-xl p-1">
                                            {['expense', 'income'].map(t => (
                                                <button 
                                                    key={t}
                                                    className={`flex-1 py-2 rounded-lg text-sm font-bold transition ${newTx.type === t ? 'bg-white shadow-sm text-gray-800' : 'text-gray-400'}`}
                                                    onClick={() => setNewTx({...newTx, type: t, categoryId: t === 'expense' ? 'exp1' : 'inc1'})}
                                                >
                                                    {t === 'expense' ? 'ÊîØÂá∫' : 'Êî∂ÂÖ•'}
                                                </button>
                                            ))}
                                        </div>
                                        <input 
                                            type="number" 
                                            className="w-full text-4xl font-bold text-center py-4 bg-transparent border-b border-gray-200 outline-none" 
                                            placeholder="0"
                                            autoFocus
                                            value={newTx.amount}
                                            onChange={e => setNewTx({...newTx, amount: e.target.value})}
                                        />
                                        <div className="grid grid-cols-5 gap-2 max-h-40 overflow-y-auto py-2">
                                            {data.categories.filter(c => c.type === newTx.type).map(c => (
                                                <button 
                                                    key={c.id} 
                                                    onClick={() => setNewTx({...newTx, categoryId: c.id})}
                                                    className={`flex flex-col items-center gap-1 p-2 rounded-xl border ${newTx.categoryId === c.id ? 'bg-blue-50 border-blue-200' : 'border-transparent'}`}
                                                >
                                                    <span className="text-xl">{c.icon}</span>
                                                    <span className="text-[10px] text-gray-600 truncate w-full text-center">{c.name}</span>
                                                </button>
                                            ))}
                                        </div>
                                        <input 
                                            type="date" 
                                            className="w-full p-3 bg-gray-50 rounded-xl"
                                            value={newTx.date}
                                            onChange={e => setNewTx({...newTx, date: e.target.value})}
                                        />
                                        <input 
                                            type="text" 
                                            className="w-full p-3 bg-gray-50 rounded-xl"
                                            placeholder="ÂÇôË®ª (ÈÅ∏Â°´)"
                                            value={newTx.note}
                                            onChange={e => setNewTx({...newTx, note: e.target.value})}
                                        />
                                        <button onClick={saveTransaction} className="w-full py-3 bg-ios-blue text-white rounded-xl font-bold shadow-lg">ÂÑ≤Â≠ò</button>
                                    </div>
                                </Modal>
                            )}
                        </div>
                    );
                } 
                
                // Sub-View: Account List
                return (
                    <div className="p-6 space-y-6 pb-20">
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="text-xl font-bold text-gray-800">ÊàëÁöÑÂ∏≥Êà∂</h3>
                            <button onClick={() => setInputModal({
                                show: true,
                                title: 'Êñ∞Â¢ûÂ∏≥Êà∂ÂêçÁ®±',
                                value: '',
                                type: 'add_account'
                            })} className="text-ios-blue text-sm font-medium">+ Êñ∞Â¢û</button>
                        </div>
                        
                        <div className="grid gap-4">
                            {data.accounts.map(acc => {
                                const bal = calculateBalance(acc.id);
                                return (
                                    <div 
                                        key={acc.id} 
                                        onClick={() => setSelectedAccount(acc.id)}
                                        className="bg-white p-4 rounded-2xl shadow-sm flex items-center justify-between active:scale-[0.98] transition cursor-pointer"
                                    >
                                        <div className="flex items-center gap-4">
                                            <div className={`w-12 h-12 rounded-full ${acc.color} flex items-center justify-center text-white text-lg shadow-md`}>
                                                {acc.type === 'cash' ? 'üíµ' : acc.type === 'bank' ? 'üè¶' : 'üí≥'}
                                            </div>
                                            <div>
                                                <div className="font-bold text-gray-800">{acc.name}</div>
                                                <div className="text-xs text-gray-400 uppercase">{acc.type}</div>
                                            </div>
                                        </div>
                                        <div className={`text-lg font-bold ${bal < 0 ? 'text-red-500' : 'text-gray-800'}`}>
                                            ${bal.toLocaleString()}
                                        </div>
                                    </div>
                                )
                            })}
                        </div>
                    </div>
                );
            };

            // 4. Wealth (Stock) Module
            const WealthView = () => {
                const [showTrade, setShowTrade] = useState(false);
                const [trade, setTrade] = useState({ symbol: '', name: '', price: '', quantity: '', type: 'buy' });

                const handleTrade = () => {
                    if (!trade.symbol || !trade.price || !trade.quantity) return;
                    
                    const price = parseFloat(trade.price);
                    const qty = parseInt(trade.quantity);
                    const newTx = { ...trade, id: Date.now().toString(), price, quantity: qty, date: new Date().toISOString() };
                    
                    // Update Portfolio
                    let newStocks = [...data.stocks];
                    const existing = newStocks.find(s => s.symbol === trade.symbol);
                    
                    if (trade.type === 'buy') {
                        if (existing) {
                            const totalCost = (existing.avgCost * existing.quantity) + (price * qty);
                            existing.quantity += qty;
                            existing.avgCost = totalCost / existing.quantity;
                        } else {
                            newStocks.push({ id: Date.now().toString(), symbol: trade.symbol, name: trade.name || trade.symbol, quantity: qty, avgCost: price, currentPrice: price });
                        }
                    } else {
                        if (existing && existing.quantity >= qty) {
                            existing.quantity -= qty;
                            if (existing.quantity === 0) newStocks = newStocks.filter(s => s.symbol !== trade.symbol);
                        } else {
                            showToast('Â∫´Â≠ò‰∏çË∂≥', 'error');
                            return;
                        }
                    }

                    saveData({
                        ...data,
                        stocks: newStocks,
                        stockTransactions: [...data.stockTransactions, newTx]
                    });
                    setShowTrade(false);
                    setTrade({ symbol: '', name: '', price: '', quantity: '', type: 'buy' });
                };

                const totalWealth = data.stocks.reduce((sum, s) => sum + (s.quantity * s.currentPrice), 0);
                const totalCost = data.stocks.reduce((sum, s) => sum + (s.quantity * s.avgCost), 0);
                const profit = totalWealth - totalCost;
                const profitPercent = totalCost > 0 ? (profit / totalCost) * 100 : 0;

                return (
                    <div className="pb-24">
                        <div className="bg-white/80 backdrop-blur-md sticky top-0 z-10 px-6 py-4 border-b border-gray-200">
                             <div className="flex justify-between items-center mb-4">
                                <h3 className="text-xl font-bold text-gray-800">ËÇ°Á•®Â∫´Â≠ò</h3>
                                <button onClick={() => setShowTrade(true)} className="text-ios-blue text-sm">‰∫§Êòì</button>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div className="bg-ios-blue/10 p-4 rounded-2xl">
                                    <div className="text-xs text-ios-blue mb-1">Á∏ΩÂ∏ÇÂÄº</div>
                                    <div className="text-2xl font-bold text-ios-blue">${totalWealth.toLocaleString()}</div>
                                </div>
                                <div className={`p-4 rounded-2xl ${profit >= 0 ? 'bg-ios-green/10' : 'bg-ios-red/10'}`}>
                                    <div className={`text-xs mb-1 ${profit >= 0 ? 'text-ios-green' : 'text-ios-red'}`}>Êú™ÂØ¶ÁèæÊêçÁõä</div>
                                    <div className={`text-2xl font-bold ${profit >= 0 ? 'text-ios-green' : 'text-ios-red'}`}>
                                        {profit >= 0 ? '+' : ''}{profit.toLocaleString()}
                                        <span className="text-xs ml-1">({profitPercent.toFixed(1)}%)</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="p-4 grid gap-3">
                            {data.stocks.map(s => {
                                const stockProfit = (s.currentPrice - s.avgCost) * s.quantity;
                                const stockProfitP = (stockProfit / (s.avgCost * s.quantity)) * 100;
                                return (
                                    <div key={s.symbol} className="bg-white p-4 rounded-2xl shadow-sm flex justify-between items-center">
                                        <div>
                                            <div className="flex items-center gap-2">
                                                <span className="font-bold text-lg">{s.symbol}</span>
                                                <span className="text-xs bg-gray-100 px-2 py-0.5 rounded text-gray-500">{s.name}</span>
                                            </div>
                                            <div className="text-xs text-gray-400 mt-1">{s.quantity} ËÇ° ‚Ä¢ ÂùáÂÉπ ${s.avgCost.toFixed(1)}</div>
                                        </div>
                                        <div className="text-right">
                                            <div className="font-bold text-lg">${s.currentPrice}</div>
                                            <div className={`text-xs font-bold ${stockProfit >= 0 ? 'text-ios-green' : 'text-ios-red'}`}>
                                                {stockProfit >= 0 ? '+' : ''}{stockProfit.toLocaleString()} ({stockProfitP.toFixed(1)}%)
                                            </div>
                                        </div>
                                    </div>
                                )
                            })}
                        </div>

                        {showTrade && (
                            <Modal title="Êñ∞Â¢û‰∫§Êòì" onClose={() => setShowTrade(false)}>
                                <div className="space-y-4">
                                     <div className="flex bg-gray-100 rounded-xl p-1">
                                        {['buy', 'sell'].map(t => (
                                            <button 
                                                key={t}
                                                className={`flex-1 py-2 rounded-lg text-sm font-bold transition ${trade.type === t ? (t === 'buy' ? 'bg-ios-red text-white' : 'bg-ios-green text-white') : 'text-gray-400'}`}
                                                onClick={() => setTrade({...trade, type: t})}
                                            >
                                                {t === 'buy' ? 'Ë≤∑ÂÖ•' : 'Ë≥£Âá∫'}
                                            </button>
                                        ))}
                                    </div>
                                    <input className="w-full p-3 bg-gray-50 rounded-xl" placeholder="‰ª£Ëôü (e.g., 2330)" value={trade.symbol} onChange={e => setTrade({...trade, symbol: e.target.value.toUpperCase()})} />
                                    <input className="w-full p-3 bg-gray-50 rounded-xl" placeholder="ÂêçÁ®± (ÈÅ∏Â°´)" value={trade.name} onChange={e => setTrade({...trade, name: e.target.value})} />
                                    <div className="flex gap-2">
                                        <input type="number" className="flex-1 p-3 bg-gray-50 rounded-xl" placeholder="ÂÉπÊ†º" value={trade.price} onChange={e => setTrade({...trade, price: e.target.value})} />
                                        <input type="number" className="flex-1 p-3 bg-gray-50 rounded-xl" placeholder="ËÇ°Êï∏" value={trade.quantity} onChange={e => setTrade({...trade, quantity: e.target.value})} />
                                    </div>
                                    <button onClick={handleTrade} className="w-full py-3 bg-ios-blue text-white rounded-xl font-bold">Á¢∫Ë™ç</button>
                                </div>
                            </Modal>
                        )}
                    </div>
                );
            };


            // --- Navigation Layout ---

            return (
                <div className="max-w-md mx-auto min-h-screen bg-ios-bg relative overflow-hidden shadow-2xl">
                    {/* Top Status Bar */}
                    <div className="flex justify-between items-center px-6 pt-12 pb-2 bg-ios-bg sticky top-0 z-20">
                        <h1 className="text-2xl font-bold text-gray-900 tracking-tight">
                            {view === 'settings' ? 'Ë®≠ÂÆö' : 
                             view === 'wealth' ? 'ÊäïË≥áÁêÜË≤°' :
                             view === 'accounting' ? (selectedAccount ? 'Ë®òÂ∏≥ÊòéÁ¥∞' : 'ÊàëÁöÑË®òÂ∏≥') : 'ÈÄöÂæÄË≤°ÂØåËá™Áî±‰πãË∑Ø'}
                        </h1>
                        <div className="flex items-center gap-3">
                            {view === 'settings' ? (
                                <button onClick={() => setView('dashboard')} className="text-ios-blue font-bold text-lg">
                                    ÂÆåÊàê
                                </button>
                            ) : (
                                <>
                                    {/* Sync Status Icon */}
                                    <div className="relative flex items-center justify-center">
                                        <div title={syncStatus} className={`
                                            transition-colors duration-300
                                            ${syncStatus === 'syncing' ? 'text-ios-green animate-spin' : 
                                              syncStatus === 'success' ? 'text-ios-green' : 
                                              syncStatus === 'error' ? 'text-ios-red' : 'text-gray-400'}
                                        `}>
                                            <i data-lucide="refresh-cw" className="w-5 h-5"></i>
                                        </div>
                                    </div>
                                    
                                    {/* Settings Icon: Only show on Dashboard */}
                                    {view === 'dashboard' && (
                                        <button onClick={() => setView('settings')} className="p-2 bg-white rounded-full shadow-sm hover:shadow-md transition">
                                            <i data-lucide="settings" className="w-5 h-5 text-gray-600"></i>
                                        </button>
                                    )}
                                </>
                            )}
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="animate-slide-up min-h-full">
                        {view === 'settings' && <SettingsView />}
                        {view === 'dashboard' && <DashboardView />}
                        {view === 'accounting' && <AccountingView />}
                        {view === 'wealth' && <WealthView />}
                    </div>

                    {/* Bottom Navigation for Modules (NOT visible in Dashboard/Settings, only in Modules) */}
                    {(view === 'accounting' || view === 'wealth') && (
                        <div className="fixed bottom-0 w-full max-w-md bg-white/80 backdrop-blur-xl border-t border-gray-200 p-2 pb-6 flex justify-around items-center z-30">
                            <button onClick={() => { setView('dashboard'); setSelectedAccount(null); }} className={`flex flex-col items-center p-2 rounded-xl w-16 transition ${view === 'dashboard' ? 'text-ios-blue' : 'text-gray-400'}`}>
                                <i data-lucide="layout-grid" className="w-6 h-6"></i>
                                <span className="text-[10px] mt-1 font-medium">Á∏ΩË¶Ω</span>
                            </button>
                            <button onClick={() => { setView('accounting'); setSelectedAccount(null); }} className={`flex flex-col items-center p-2 rounded-xl w-16 transition ${view === 'accounting' ? 'text-ios-blue' : 'text-gray-400'}`}>
                                <i data-lucide="notebook-pen" className="w-6 h-6"></i>
                                <span className="text-[10px] mt-1 font-medium">Ë®òÂ∏≥</span>
                            </button>
                            <button onClick={() => setView('wealth')} className={`flex flex-col items-center p-2 rounded-xl w-16 transition ${view === 'wealth' ? 'text-ios-blue' : 'text-gray-400'}`}>
                                <i data-lucide="trending-up" className="w-6 h-6"></i>
                                <span className="text-[10px] mt-1 font-medium">ÁêÜË≤°</span>
                            </button>
                        </div>
                    )}

                    {/* Toast Notification */}
                    {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}

                    {/* Generic Input Modal */}
                    {inputModal.show && (
                        <Modal title={inputModal.title} onClose={() => setInputModal({ ...inputModal, show: false })}>
                            <div className="space-y-4">
                                <input
                                    autoFocus
                                    className="w-full p-3 bg-gray-50 rounded-xl"
                                    value={inputModal.value}
                                    onChange={(e) => setInputModal({ ...inputModal, value: e.target.value })}
                                    onKeyDown={(e) => e.key === 'Enter' && handleInputConfirm()}
                                    placeholder="Ë´ãËº∏ÂÖ•ÂêçÁ®±"
                                />
                                <button onClick={handleInputConfirm} className="w-full py-3 bg-ios-blue text-white rounded-xl font-bold">Á¢∫Ë™ç</button>
                            </div>
                        </Modal>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
