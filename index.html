<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>通往財富自由之路</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:#f8fafc;}</style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons ---
        const Icon = ({ name, size=24, className }) => {
            useEffect(() => { lucide.createIcons(); }, [name]);
            return <i data-lucide={name} width={size} height={size} className={className}></i>;
        };

        const generateId = () => Math.random().toString(36).substr(2, 9);
        const DEFAULT_USERS = [{ id: 'u_default', name: '我 (主帳號)' }];

        const App = () => {
            const [users, setUsers] = useState(() => JSON.parse(localStorage.getItem('fp_users')) || DEFAULT_USERS);
            const [selectedUser, setSelectedUser] = useState(() => JSON.parse(localStorage.getItem('fp_current_user')) || users[0]);
            const [showMenu, setShowMenu] = useState(false);

            useEffect(() => {
                localStorage.setItem('fp_users', JSON.stringify(users));
                localStorage.setItem('fp_current_user', JSON.stringify(selectedUser));
                lucide.createIcons();
            }, [users, selectedUser]);

            const handleCreateUser = () => {
                const name = prompt("請輸入新使用者名稱：");
                if (name && name.trim()) {
                    const newUser = { id: generateId(), name: name.trim() };
                    setUsers([...users, newUser]);
                    setSelectedUser(newUser);
                    setShowMenu(false);
                }
            };

            const handleNavigate = (page) => {
                // 儲存當前使用者狀態，讓子頁面讀取
                localStorage.setItem('fp_current_user', JSON.stringify(selectedUser));
                window.location.href = page;
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-6 animate-fade-in">
                    <div className="max-w-md w-full space-y-8">
                        <div className="text-center space-y-6">
                            <div className="inline-flex p-6 bg-gray-900 rounded-[2.5rem] text-white shadow-2xl mb-2">
                                <Icon name="layout" size={48} />
                            </div>
                            <div>
                                <h1 className="text-3xl font-black text-gray-900 tracking-tight">通往財富自由之路</h1>
                                <p className="text-gray-400 mt-2 font-medium">請選擇功能模組</p>
                            </div>
                        </div>

                        {/* User Switcher */}
                        <div className="flex justify-center relative">
                            <button onClick={() => setShowMenu(!showMenu)} className="bg-white px-5 py-2.5 rounded-full shadow-sm border border-gray-200 flex items-center gap-3 text-sm text-gray-600 hover:bg-gray-50 transition-colors">
                                <Icon name="user-cog" size={18} className="text-gray-400"/> 
                                <span>當前使用者:</span>
                                <span className="font-bold text-gray-900">{selectedUser?.name}</span>
                                <Icon name={showMenu ? "chevron-up" : "chevron-down"} size={16} />
                            </button>

                            {showMenu && (
                                <div className="absolute top-full mt-2 w-64 bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden z-50">
                                    <div className="max-h-48 overflow-y-auto p-1">
                                        {users.map(u => (
                                            <button key={u.id} onClick={() => { setSelectedUser(u); setShowMenu(false); }} className={`w-full text-left px-4 py-3 rounded-xl text-sm font-bold flex items-center gap-3 hover:bg-gray-50 ${u.id === selectedUser.id ? 'bg-blue-50 text-blue-600' : 'text-gray-700'}`}>
                                                <div className="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-xs text-gray-600">{u.name[0]}</div>
                                                <span className="truncate">{u.name}</span>
                                                {u.id === selectedUser.id && <Icon name="check" size={16} className="ml-auto"/>}
                                            </button>
                                        ))}
                                    </div>
                                    <div className="border-t border-gray-100 p-1">
                                        <button onClick={handleCreateUser} className="w-full text-left px-4 py-3 rounded-xl text-sm font-bold flex items-center gap-3 text-blue-600 hover:bg-blue-50">
                                            <Icon name="user-plus" size={16} /> 新增使用者
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>
                        
                        {/* Modules */}
                        <div className="space-y-4">
                            <button onClick={() => handleNavigate('accounting.html')} className="w-full bg-white p-6 rounded-[2.5rem] shadow-lg border border-gray-100 flex items-center gap-6 hover:scale-[1.02] hover:shadow-2xl hover:border-blue-100 transition-all group relative overflow-hidden">
                                <div className="w-16 h-16 rounded-2xl bg-blue-50 text-blue-600 flex items-center justify-center shadow-sm z-10"><Icon name="wallet" size={32} /></div>
                                <div className="text-left flex-1 z-10"><h3 className="text-xl font-bold text-gray-900 group-hover:text-blue-600">現金帳本</h3><p className="text-gray-400 text-sm mt-1">日常收支、資產管理</p></div>
                                <div className="bg-gray-50 p-3 rounded-full text-gray-300 z-10"><Icon name="arrow-right" size={20} /></div>
                                <div className="absolute -right-10 -bottom-10 w-32 h-32 bg-blue-50 rounded-full blur-3xl opacity-0 group-hover:opacity-100 transition-opacity"></div>
                            </button>

                            <button onClick={() => handleNavigate('investment.html')} className="w-full bg-white p-6 rounded-[2.5rem] shadow-lg border border-gray-100 flex items-center gap-6 hover:scale-[1.02] hover:shadow-2xl hover:border-purple-100 transition-all group relative overflow-hidden">
                                <div className="w-16 h-16 rounded-2xl bg-purple-50 text-purple-600 flex items-center justify-center shadow-sm z-10"><Icon name="trending-up" size={32} /></div>
                                <div className="text-left flex-1 z-10"><h3 className="text-xl font-bold text-gray-900 group-hover:text-purple-600">證券投資</h3><p className="text-gray-400 text-sm mt-1">股票、ETF、股利</p></div>
                                <div className="bg-gray-50 p-3 rounded-full text-gray-300 z-10"><Icon name="arrow-right" size={20} /></div>
                                <div className="absolute -right-10 -bottom-10 w-32 h-32 bg-purple-50 rounded-full blur-3xl opacity-0 group-hover:opacity-100 transition-opacity"></div>
                            </button>
                        </div>
                    </div>
                    <div className="absolute bottom-8 text-[10px] text-gray-300 font-mono tracking-widest">SPLIT VERSION 1.0</div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
